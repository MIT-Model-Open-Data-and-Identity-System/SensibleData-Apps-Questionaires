{% extends "base.html" %}

{% block content %}
	<script>
		var actor;
		function validateForm()
		{
			if (actor == 'prev') {
				return true;
			}
			var required_vars = document.forms["myform"]["__required_vars"].value;
			required_vars = required_vars.split(',');
			for (var idx=0; idx<required_vars.length; idx++) {
				// check if radio group:
				if (document.forms["myform"][required_vars[idx]] instanceof NodeList) || (document.forms["myform"][required_vars[idx]] instanceof HTMLCollection){
					var answered = false;
					for (var inner_idx=0; inner_idx < document.forms["myform"][required_vars[idx]].length; inner_idx++) {
						if (document.forms["myform"][required_vars[idx]][inner_idx].type == "number") {
							if (document.forms["myform"][required_vars[idx]][inner_idx].value > 0) {
								answered = true;
							}
						}
						else if (document.forms["myform"][required_vars[idx]][inner_idx].checked) {
							answered = true;
						}
					}
					if (!answered) {
						document.getElementById("answer_alert").style.display = "block";
 						return false;
					}
				}
				else if (document.forms["myform"][required_vars[idx]].value == null || document.forms["myform"][required_vars[idx]].value == "") {
					//document.forms["myform"][required_vars[idx]].className = 'control-group error';
					document.getElementById("answer_alert").style.display = "block";
					return false;
				}	
			}
		
		}
	</script>
		<!-- progress bar goes here -->
		<div class="progress">
  			<div class="bar" style="width: {{ progress }}%;"></div>
		</div>        
		<!-- deciding on the heading -->
		{% if last_page %}
			<h1>The end</h1>
			<p>Thank you for finishing the survey, you can now close this browser tab. </p>
		{% endif %}
		
		<!-- display the error message -->
		{% if unanswered %}
			<div class="alert alert-error" id="answer_alert">
		{% else %}
			<div class="alert alert-error" id="answer_alert" style="display:none">
		{% endif %}
				Please answer the question before continuing.
			</div>
    	<form action="form" method="post" name="myform" onsubmit="return validateForm()">
			<fieldset>
				{% csrf_token %}
				
				<!-- display the question? -->
				{% if last_page %}
					<input type="hidden" name="__question_name" value="__goodbye" />
				{% else %}
					{{ question|safe }} 
				{% endif %}

				<div class="form-actions">
				
					<!-- Which buttons to display? -->
					{% if last_page %}
						<button type="submit" onclick="actor='prev'" name="_prev" class="btn"><i class="icon-chevron-left"></i> Previous</button>
						<button type="submit" name="_from_top" class="btn btn-primary"><i class="icon-refresh icon-white"></i> Start from the beginning</button>
					{% else %}
						<button type="submit" onclick="actor='next_new'" name="_next_new" class="btn btn-primary">Next unanswered question <i class="icon-chevron-right"></i><i class="icon-chevron-right"></i></button> 	
						<button type="submit" onclick="actor='prev'" name="_prev" class="btn"><i class="icon-chevron-left"></i> Previous</button>
						<button type="submit" onclick="actor='next'" name="_next" class="btn">Next <i class="icon-chevron-right"></i> </button>
					{% endif %}
			</fieldset>
		</form>


{% endblock %}
